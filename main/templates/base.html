<head>
    {% block head %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width:device-width,initial-scale=1.0,user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="keywords" content="SuperFarmer,Kyan"/>
        <meta name="description" content="SuperFarmer.net is a website for Kyan (a.k.a. SuperFarmer)"/>
        <link rel="icon" href="/static/img/favicon.png" />
        <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-paper.css">
        <link rel="stylesheet" href="/static/css/KyanCssUtil.css">
        <script type="text/javascript" src="/static/js/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="/static/bootstrap/js/bootstrap.js"></script>
        <title>{% block title %}{% endblock %} - SuperFarmer.net</title>
        <style>
            #footer-div .footer {
                background-color: #eeeeee;
                padding: 1em;
                text-align: center;
                font-size: 1em;
                color: gray;
            }
            #footer-div .footer a{
                text-decoration: none;
            }
            #user-bar {
                width: 100%;
                background-color: rgba(255,255,255,0.5);
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1000;
                padding-right: 5%;
                padding-left: 5%;
                padding-top: 10px;
                padding-bottom: 10px;
                font-size: 15px;
            }
            #user-bar img {
                max-height: 15px;
                max-width: 15px;
            }
            #user-bar .nologinshow, #user-bar .loginshow {
                display: none;
                float: right;
            }
        </style>
    {% endblock head %}
</head>
<body>
    {% block userbar %}
    <nav id='user-bar'>
        <span class="nologinshow">
            <a href="/user/signup" class="btn btn-primary btn-sm">注册</a>
            <span> </span>
            <a href="/user/signin" class="btn btn-default btn-sm">登录</a>
        </span>
        <span class="loginshow">
            <span>Hi, </span>
            <a class="profile-avatarlink" href='' target="_blank">
                <img class="profile-avatar">
            </a>
            <a class="profile-link" href=''>
                <b class="profile-nikename"></b>
            </a>
            <a href="/user/logout" class="btn btn-default btn-sm">登录</a>
        </span>


    </nav>
    {% endblock userbar %}
    <div id='content'>
        {% block content %}
        {% endblock content %}
    </div>
    <div id='footer-div'>
        {% block footer %}
            <div class="footer">
                <div>
                    <strong>Be happy.</strong>
                    <i>Keep Healthy, Keep Happy, Keep Thinking, Keep Cool.</i>
                </div>
                <div>
                    Powered By
                    <a href="http://www.superfarmer.net">SuperFarmer</a>
                </div>
            </div>
        {% endblock footer %}
    </div>
    <script type="text/javascript">
        $(document).ready(function(){
            getLoginUser();
        });
        function getLoginUser(){
            $.ajax({
                type: "GET",
                url: "/user/getlogin/",
                data: {},
                success: function (data) {
                    var result = data;
                    if (result.error) {
                        alert(result.error);
                    } else if (result.nologinuser) {
                        $("#user-bar .nologinshow").fadeIn();
                    } else {
                        $("#user-bar .profile-link").attr('href','/user/user?id='+result.id);
                        $("#user-bar .profile-avatarlink").attr('href','/user/avatar/'+result.email+"/");
                        $("#user-bar .profile-nikename").text(result.nickname);
                        $("#user-bar .profile-avatar").attr('src',result.avatar);
                        $("#user-bar .loginshow").fadeIn();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("Ajax Error, XMLHttpRequest:");
                    console.log("status: " + XMLHttpRequest.status);
                    console.log("readyState: " + XMLHttpRequest.readyState);
                    console.log("textStatus: " + textStatus);
                },
            });
        }
    </script>
</body>
